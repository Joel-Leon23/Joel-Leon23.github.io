<!DOCTYPE html>
<html>
<head>
  <title>Problema de la Mochila</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h2 class="mt-3">Problema de la Mochila</h2>

    <form id="knapSackForm" class="mt-3">
      <div class="form-group">
        <label for="capacity">Capacidad</label>
        <input type="number" class="form-control" id="capacity" name="capacity">
      </div>
      
      <div id="itemContainer">
        <div class="form-row item">
          <div class="form-group col-md-6">
            <label for="value">Valor</label>
            <input type="number" class="form-control value">
          </div>
          <div class="form-group col-md-6">
            <label for="weight">Peso</label>
            <input type="number" class="form-control weight">
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="col-sm-6">
          <button type="button" id="addItem" class="btn btn-primary btn-block">AÃ±adir Item</button>
        </div>
        <div class="col-sm-6">
          <button type="submit" class="btn btn-success btn-block">Calcular</button>
        </div>
      </div>
    </form>

    <div id="result" class="mt-5">
      <h4>Resultados:</h4>
      <p id="totalWeight"></p>
      <p id="totalValue"></p>
      <table id="selectedItems" class="table table-striped">
        <thead>
          <tr>
            <th>Item</th>
            <th>Valor</th>
            <th>Peso</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const lookup = new Map();
    const selectedItems = [];

    function getKnapSack(capacity, n, items, lookup, selectedItems) {
      if (capacity < 0) return Number.MIN_SAFE_INTEGER;
      if (capacity === 0 || n < 0) return 0;
    
      const key = `${n}|${capacity}`;
    
      if (!lookup.has(key)) {
        const include = items[n].value + getKnapSack(capacity - items[n].weight, n - 1, items, lookup, selectedItems);
        const exclude = getKnapSack(capacity, n - 1, items, lookup, selectedItems);
    
        if (include > exclude) {
          selectedItems[n] = true;
          lookup.set(key, include);
        } else {
          selectedItems[n] = false;
          lookup.set(key, exclude);
        }
      }
      return lookup.get(key);
    }
    

    document.getElementById('addItem').addEventListener('click', () => {
      const itemContainer = document.getElementById('itemContainer');
      const newItem = document.createElement('div');
      newItem.className = 'form-row item';
      newItem.innerHTML = `
        <div class="form-group col-md-6">
          <label for="value">Valor</label>
          <input type="number" class="form-control value">
        </div>
        <div class="form-group col-md-6">
          <label for="weight">Peso</label>
          <input type="number" class="form-control weight">
        </div>
      `;
      itemContainer.appendChild(newItem);
    });

    document.getElementById('knapSackForm').addEventListener('submit', (e) => {
      e.preventDefault();
      lookup.clear();
    
      const capacity = document.getElementById('capacity').value;
      const values = Array.from(document.getElementsByClassName('value')).map(x => Number(x.value));
      const weights = Array.from(document.getElementsByClassName('weight')).map(x => Number(x.value));
      const items = values.map((v, i) => ({ value: v, weight: weights[i] }));
    
      selectedItems.length = 0;
      selectedItems.length = items.length;
    
      const totalValue = getKnapSack(capacity, items.length - 1, items, lookup, selectedItems);
      document.getElementById('totalValue').innerText = 'Valor total: ' + totalValue;
    
      let totalWeight = 0;
      const tableBody = document.getElementById('selectedItems').getElementsByTagName('tbody')[0];
      tableBody.innerHTML = '';
      items.forEach((item, index) => {
        if (selectedItems[index]) {
          totalWeight += item.weight;
          const newRow = tableBody.insertRow();
          newRow.insertCell(0).innerText = index + 1;
          newRow.insertCell(1).innerText = item.value;
          newRow.insertCell(2).innerText = item.weight;
        }
      });
    
      document.getElementById('totalWeight').innerText = 'Peso total: ' + totalWeight;
    });    
  </script>
</body>
</html>
